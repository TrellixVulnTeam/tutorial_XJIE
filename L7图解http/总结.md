网络和http协议
===
当在浏览器当中键入 www.taobao.com ,经历了哪些过程
## TCP/IP协议族
协议protocol： 不同设备之间通讯，先确定好通讯规则（如何建立联系，如何通讯，如何结束，介质）。
就好像 沟通前先打招呼，语言或微信或邮件进行沟通。 
本质各种协议都是传输信息，只不过各有所长、和各个厂商机构利益拉扯。
### 常用协议
TCP：三次握手，IP协议的底层协议。 场景：http网站
UDP：不用握手直接发送信息，速度比tcp块，可靠性不如tcp。场景：视频，游戏。
IP：ipv4 192.168.11.11  ，定义计算机在网络上唯一位置。
DNS：domain server， 域名到ip地址的转换
HTTP：hyper text transaction protocol  超文本传输协议，看网站
FTP: file transfer protocol  文件传输协议，客户端连接服务器上传文件。
ieee 802.3: wifi
PPPoE（了解）：家庭宽带上网连接联通服务器

## 网络分层
两种答案：七层分层 四层分层
1. 链路层。 物理意义上的，网卡、光纤、电脑主板，芯片。
2. 网络层。 电脑、路由器、网线连成的网络。
3. 传输层。 tcp udp协议传输数据报文（每一个tcp报文一个完整请求里的一小段）。
4. 应用层。 tcp小报文组合成http请求，浏览器解析http响应信息，最终呈现在用户眼前。
七层分层 https://baike.baidu.com/item/%E7%BD%91%E7%BB%9C%E4%B8%83%E5%B1%82%E5%8D%8F%E8%AE%AE/6056879?fr=aladdin

## 客户端和服务器
服务器：网络服务提供者。别人的电脑，存储着信息，等待服务各个请求它的客户端电脑。
客户端：访问者。自己/别人的电脑、手机。

网站整体访问流程： 客户端发起请求，服务器接收和响应请求。
请求：request
响应：response   web服务返回的响应是html代码

## 重要协议
### DNS协议
#### 概念
domain server域名服务器。  
公网ip： 171.8.203.237，确定世界上唯一一台电脑的网络位置。
只有ip的缺点：场景，一个网站，积累了不少用户，有一天服务器配置不够需要换机器。ip改变，网站只能发送邮件通知，有些用户看不到导致用户流失；ip不好记。
域名：为了改变上述缺点，域名出现。ip好像身份证，域名好像姓名。 例如一级域名baidu.com  , 1owo.com 。
二级域名 www.baidu.com   news.163.com  为了指向不同的服务器。
常见域名后缀.com  .cn  .org 
mac地址好像人的dna，ip好像街道门牌号，域名好像 xx大厦。
#### dns
查询域名的ip：站长工具输入网站查询
dns协议：域名 映射指向 ip地址（服务器电脑），   www.baidu.com → 46.222.45.67 。
dns服务器：专门维护域名到ip地址的映射，维护一个非常大的hash表。 常用的dns服务器有8.8.8.8谷歌 ，阿里云223.5.5.5， 144.144.144.144， 联通电信自己的。 。
在域名平台后台进行配置。全球顶级dns服务器和下级地市服务器不断同步。10分钟-2天。
#### （了解）科学上网和软件破解原理
dns污染: google.com →  错误的ip地址。  解决方式：替换hosts文件，老D博客。

本地hosts文件: 也是域名到ip地址的映射。但优先级最高，比dns服务器高。为了节省每次请求dns服务器的时间，浏览器会先读取电脑本地的hosts文件，看有没有写好的映射，有的话直接按照hosts文件的映射来，没有的再请求dns服务器。
基于修改hosts的软件破解原理：adobe jetbrains系列。 修改hosts添加0.0.0.0 www.jetbrains.com , 0.0.0.0表示一个空地址，任何请求这个地址的请求都会被丢掉。 网上找的激活码是算出来的盗版的，软件开启后，将激活码发送到服务器数据库验证，验证不通过返回一个锁死软件请求。

### IP协议
#### 概念
ip 四段0-255构成的数字  形如 192.168.11.11   45.57.222.222
ip地址：确定一台电脑在网络上的唯一位置，好像门牌号，通信时根据ip找到目标电脑。
mac物理地址：每一台电脑主板集成网卡或独立网卡都有全球唯一地址。  00-xx-A6-6B-xx-xx 。
arp协议（了解）：ip地址连接的电脑也不是一直不变的。为了确定唯一目标电脑，发现局域网中的其它电脑，ip → mac地址。

ip协议可以让请求再网络层不断跳转，最终找到目标服务器。
路由跟踪命令：tracert baidu.com，观察跳转。 

#### ip地址分类和计算：
表示：ip地址，二进制表示为四个字节：00000001 00000000 00000000 00000001，平时为了方便观看转换为十进制 。   0.0.0.0  - 255.255.255.255 。

ipv4、ipv6：从前电脑昂贵和稀少，科学家从省内存和够用的角度用4个字节存储ip地址，成为ipv4。结果后来互联网席卷全球、电脑手机工控设备都需要网络地址，不够用了，所以后来用6个字节（转换为16进制），可以容纳非常多的地址，目前正在推广中。

#### 局域网 
广域网（www万维网）> 城域网（省）> 局域网(以太网 Ethernet)
局域网地址：ipv4公网地址不够用。解决，一群人用一个公网ip地址，通过路由器，用特殊的ip地址段表示子网。 把前面一两个字节的值置为固定值表示局域网段，后面的供子网机器取各种可能。 111111000 11111100 00000001 00000001  。
常用局域网段： 192.168.x.x  (可能性192.168.1.1--192.168.255.255,255*255台电脑)，每个小房间分配192.168.119.x(这个小房间可以容纳255台机器)。
10.x.x.x ,可以容纳更多的机器。
255.255.255.248/28 (另一种表示方法，前28位固定4位自由搭配，30台机器)。

广播地址: 192.168.119.255 发送给这个地址的信息分发到所有局域网机器中。
特殊地址：127.0.0.1 等于 localhost 本地主机。   0.0.0.0丢弃请求。

网关：192.168.x.x 习惯上第三字节划分为房间标识，第四个字节分配给房间内各个电脑。 例如给一个房间分配 192.168.1.1 -192.168.1.254，需要一个路由器入口，路由器入口也有ip地址，称作为网关，习惯上 192.168.1.1 。 第二个房间 网关192.168.2.1， 192.168.119.32开文件共享，其它一个教室192.168.120.5 → 192.168.120.1 → 192.168.119.1 → 192.168.119.32 

子网掩码：局域网网段前两字节固定，第三四字节不知道固定位数，子网机器数量无法确定。跟局域网地址搭配使用192.168.1.1  255.255.255.0  ，这个ip
111111000 11111100 00000001 00000001     192.168.1.1
111111111 11111111 11111111 00000000     255.255.255.0  常用
111111111 11111111 11111000 00000000     255.255.192.0   

#### 路由器（了解）
adsl上下行不对等传输   pppoe 联网
802.3 a/n/g 

常见单位：
宽带50Mbps
Mbps b代表一位‘0’，
Mbps /8=byte , 
Byte/1000=KB,      word文档20kb
kb/1000=MB,   million    ， 一首歌10MB
MB/1000=GB          硬盘500GB
GB/1000=TB          大容量硬盘3TB
快速转换 10Mbps = (10/8)MB/s

DHCP协议: dynamic 动态分配ip地址。因为手动分配局域网ip麻烦，根据网关自动分配。分配的区间叫ip地址池，设置ip过期时间叫租约。

路由器串联: 家庭三室，两个路由器串联。   运营商光纤入户， 光纤 → 光猫（model调制解调器）→ 总网线 →  （WAN world wide network）路由器(LAN local) → 各个电脑。
路由1 192.168.1.1  电脑1 192.168.1.5   路由2（wan 192.168.1.10） 192.168.2.1   手机2 192.168.2.5

### HTTP协议
超文本传输协议，网站所使用的协议。 http   https。浏览器会在网址前自动补全协议。
#### TCP协议 三次握手 四次分手
介绍：tcp协议是http协议的底层原理。把请求分成一个个小数据报文传输。
好像快递车拉着一些箱子，快递车整体看做http请求，每个快递箱子看做tcp报文。

报文：按照协议格式把元信息（协议名、 url、请求方法等）和数据封装在一小块内。

http请求的建立和销毁。
好像小明跟小红交流，先打招呼（syn）问对方有没有空，有空的话建立联系，对话完再说再见（标识）
1. 客户端发送sync同步标识
2. 服务端有空返回  sync/ack ,表示可以建立连接
3. 客户端开始发送数据
优点，数据准确，失败后重新握手，主要场景 http1.x 网站。
缺点，多次握手和多次请求消耗服务器资源。

dos攻击：deny server 拒绝服务攻击，黑客通过脚本批量请求某网站，网站服务器资源消耗殆尽，无法服务正常客户。
#### UDP协议
不握手就发送数据。
优点，效率高。场景：视频、游戏。
缺点，不准确。
#### （了解）http2 http3
http1.0/1.2 三次握手消耗服务器资源，协议发明与上世纪90年代，大量的网站使用也不好大更新。人们想了一些改进方法。
http2:  现代网页一个网页包含很多图片、子网页请求。第一个请求三次握手后就保持会话，后面的请求不用握手，从而明显节省时间。缺点：手机网络不稳定、请求断了，网页剩余内容无法加载。
识别：服务器端配置，浏览器自动识别，用户观察不到。可借助谷歌插件http indicator观察。
http3: 谷歌牵头的quic协议，采用udp，正在开发中。
#### 整体流程
1. 发起http请求 www.baidu.com
2. dns服务器  www.baidu.com   → 45.55.222.45
3. http请求拆分成tcp报文
4. 根据ip地址进行路由网络跳转找到目标机器
5. 服务器接收到tcp报文，组装http请求(把分块的报文组合起来)
6. 返回响应。 重复上面过程。

#### URI和URL
URI：Uniform Resource Identifier 统一资源定位标识符，标识资源的一个字符串。
例1 C:\Windows\xxx.xx  例2  https://www.v2ex.com/t/578978  例3 https://www.xxx.com/xxx.jpg

URL：uniform resource locator： 统一资源定位地址，俗称网址。  https://www.v2ex.com/t/578978
https://www.v2ex.com/t/578978
https://www.baidu.com/s?ie=utf-8&wd=好吃的
https:// 协议，www.baidu.com 网址指向别人的服务器，  t/578978 路由地址，服务器上资源的目录，
?ie=utf-8&wd=好吃的    问号后面跟键值对参数，多个参数 and符号 连接。
URI的含义更宽泛，URL是它的子集。

#### 观察http请求
网页右键-谷歌开发者工具，点击network标签，刷新网页。
clear 清空信息
preserve log 看重定向之前的信息
disable cache  禁止js css缓存，开发时建议勾选，以免本地代码已修改但浏览器不生效。
XHR xml request js异步请求，   img 图片， js，  css ，  doc HTML文档，
点击具体一个请求，headers请求时内容，reponse响应时内容。

访问baidu.com  先发起一个请求，服务器返回html源代码，浏览器解析百度首页代码，再去请求图片、js、css等资源。

#### 请求的方式 GET和POST
option 请求控制服务器，询问服务器支持的请求方式（post等），想让服务器发回资源
get 想从服务器上取内容。场景： 获取页面、图片、视频。 
post  客户端想把自己的信息推送给服务器。 场景：注册、登录、表单。 
put  客户端想把自己信息推送给服务器并存储。
delete   让服务器删除某个资源。
等

现状：option请求日志一般看不着。 post实际使用时代替了put、delete的功能。get请求占绝大多数。post请求用于表单。

get和post有什么区别？
1. 用途   获取信息 ，上传信息到服务器
2. 参数   get显示在url上，有最大长度限制；post 用户无法直接看到，大小无限制。
3. 回退   get可以回退；post表单提交中，回退，提示确认回退导致已填写信息丢失
4. 安全性  post更加安全。
5. 消耗资源（了解） 比get消耗更多服务器资源
6. 数据类型  get ascii字符串；post 没有限制 字符串或二进制。

#### 状态码
标识请求成功或失败。
常见状态码：
1. 200 成功
2. 404 路由错误，要找的页面不存在
3. 500 服务器代码出错
4. 300 重定向      例如注册页成功后跳转到首页
5. 401 资源存在但用户无权访问
6. 502 网关错误，服务器配置问题

#### 请求头和响应头request headers
关于请求的元信息
data（设么时间发的
content-encoding 信息格式 编码
connection : keep-alive  客户端跟服务器保持连接，下一次请求不用握手，服务消耗资源维持
url
cookie:请求时浏览器读取本地文件并发送
referrer ： 从哪来的，上一个网页的地址。  场景：爬虫伪造；登录后跳转到登录前的页面。
remote address:   请求目标ip地址
user-agent:
query string parameters :get请求  url?后跟的参数,查询字符串

比较:  cookie 其实也是参数  只不过需要长期存在,比较公共的参数,每次请求自动发送,query-param时当次请求时需要的参数

server: Apache  nginx  服务器
set-cookies： 服务器告诉浏览器需要存储一些数据


#### session和cookie
session：会话。 抽象概念，用户登录网站持续一定时间的状态。  例如淘宝登录后半个小时内访问页面不用再次输出密码。
cookie：饼干。 浏览器自带的一个小型数据库，存储键值对信息，token（user_session）= 'lkjfisudf2@%FDGE4'。
可以在开发者工具-Application-cookie。 
cookie场景： 
1. 项目业务需要的参数（需要长时间存储）
2. 表单记住账号、密码
3. 维持会话。 
    1> 客户端登录网站，用户名密码发送到服务器
    2> 数据库比对用户名密码，成功，代表用户登录。根据用户名、时间等信息再hash加密生成令牌（token 通行证）。 服务端自己存一份，随响应（set-cookies）发送给客户端一份让客户端（浏览器）存储到自己的cookie中。好像合同一式两份。
    3> 客户端发起其它请求(需要权限才能访问的资源)，在请求头中携带cookie（相当于携带了一些参数）。
    4> 服务器接收请求，查看cookie中的token键值对，比如token值，如果正确，说明用户已登录，返回需要权限才能访问的页面数据。
    
#### http代理
因为加密效果弱场景有限。
场景：爬虫时使用的代理，快代理等平台。

正向代理（以自己为基准）： 客户端 → 中介服务器 → 目标服务器（谷歌）   

#### https
http未加密,被中间人攻击,攻击者可以看到信息
https   http +  secure 基于http协议,只不过加密了
tcp报文传输时进行加密

对称加密;(明文)ACB →加密规则(A-1  B-2 c-3...) →(密文)132
对方收到密文根据加密规则反向推导出信息  优点,简单,缺点 加密规则泄露容易导致密文被破解  

非对称加密算法:RSA  ESS,正推容易  逆推难

SSL.TSL: 安全套接字层   算法可选择 TSL是基于SSL做的,并列关系,生产使用其中一个

密钥对:非对称加密生成一组密钥对,公钥public  和私钥private key
私钥是发送自己保留的  公钥给所有建立沟通的对方

明文 → 私钥→密文网络 →传输给各个联系人  → 公钥解密→明文.
根据公钥不容易反推出信息.  网络传输中被攻击者截获.服务器只需确保自己私钥安全就能确保整个信息传输的安全,联系人根据公钥也可以识别发送者信息,防止中间人伪造请求

CA认证机构:证书发放机构 cert 根据服务器.公司信息生成秘钥对的可信任机构
## 计算机原理（选做）
cpu调度 fifo
内存地址
硬盘扇区

## 参考
图解HTTP